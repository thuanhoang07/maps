<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Map Example Using Javascript</title>

    <!-- Load the Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBRr6PMgMCG4GrlhCbO_wp466zIhddRJlg&callback=initMap"
            async defer></script>

    <!-- Link to your JavaScript and CSS -->
    <script src="index.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="map"></div> <!-- Map container -->

<p id="directions"></p> <!-- Directions or other information -->

<!-- Input toggle switch -->
<!-- <label class="switch">
    <input type="checkbox" id="name">
    <span class="slider round"></span>
</label> -->

<script src="https://www.unpkg.com/@eohjsc/era-widget@1.0.14/src/index.js"></script>
<script>
    const eraWidget = new EraWidget();
    let configLAT = null;
    let configLON = null;
    let configGPSON = null;
    let configSPEED = null;
    
    eraWidget.onConfiguration((configuration) => {
        configLAT = configuration.realtime_configs[0];
        configLON = configuration.realtime_configs[1];
        configGPSON = configuration.realtime_configs[2];
        configSPEED = configuration.realtime_configs[3];


        console.log("Configuration Loaded:", configuration);

        eraWidget.requestHistories(
         new Date().getTime() - 1000 * 60 * 60 * 24,
         new Date().getTime()
        )
        console.log("requestHistories:", requestHistories);

    });

    eraWidget.onValues((values) => {
        console.log("Value:", values);
        if (configLAT && values[configLAT.id]) {
            LAT = values[configLAT.id].value;
            console.log("Value LAT:", LAT);
        }
        if (configLON && values[configLON.id]) {
            LON = values[configLON.id].value;
            console.log("Value LON:", LON);
        }
        if (configGPSON && values[configGPSON.id]) {
            GPSON = values[configGPSON.id].value;
            console.log("Value GPSON:", GPSON);
        }
        if (configSPEED && values[configSPEED.id]) {
            SPEED = values[configSPEED.id].value;
            console.log("Value SPEED:", SPEED);
        }
    });

    eraWidget.onHistories((histories) => {
      console.log("onHistories", onHistories);
    });
    






    eraWidget.ready();
</script> 
</body>
</html>

<!-- ======================================= -->

<!-- <html>
<head>
  <title>Test iFrame widget</title>
</head>
<body>
<div id="container"></div>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/modules/exporting.js"></script>
<script src="https://code.highcharts.com/modules/export-data.js"></script>
<script src="https://code.highcharts.com/modules/accessibility.js"></script>
<script src="https://www.unpkg.com/@eohjsc/era-widget@1.0.14/src/index.js"></script>
<script>
  function drawChart(categories, series) {
    Highcharts.chart('container', {
      chart: {
        type: 'column'
      },
      credits: {
        enabled: false,
      },
      title: null,
      subtitle: null,
      xAxis: {
        categories: categories,
        crosshair: true,
        accessibility: {
          description: 'Countries'
        }
      },
      yAxis: {
        min: 0,
      },
      tooltip: {
        valueSuffix: ' (1000 MT)'
      },
      plotOptions: {
        column: {
          pointPadding: 0.2,
          borderWidth: 0
        }
      },
      series: series,
    });
  }
 
</script>
<script>
  const eraWidget = new EraWidget();
  eraWidget.onConfiguration((config) => {
    console.log(config)
    eraWidget.requestHistories(
      new Date().getTime() - 1000 * 60 * 60 * 24,
      new Date().getTime()
    )               
  })
  eraWidget.onHistories((histories) => {
    const categories = histories.map((item) => item.name);
    const temperatures = []
    const summarySeries = histories.map((item) => {
      const timeByTemp = {};
      item.data?.map((dataItem) => {
        const [temp, time] = JSON.parse(dataItem.y);
        if (!temperatures.includes(temp)) {
          temperatures.push(temp);
        }
        if (!timeByTemp[temp]) {
          timeByTemp[temp] = 0;
        }
        timeByTemp[temp] += time;
      });
      return timeByTemp;
    });
    const series = temperatures.sort().map((temp) => {
      return {
        name: temp,
        data: summarySeries.map((item) => item[temp] || 0),
      };
    });
    drawChart(
      categories,
      series, 
    );
  })
  eraWidget.ready();
  eraWidget.requestAdjustMobileHeight(500);
</script>
</body>
</html> -->